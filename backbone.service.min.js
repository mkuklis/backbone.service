(function(t){"object"==typeof exports?module.exports=t(require("underscore"),require("backbone")):"function"==typeof define&&define.amd?define(["underscore","backbone"],t):t(_,Backbone)})(function(t,e){"use strict";function r(e){this.options=e||{},this.targets=s(this.options.targets||{}),t(this.targets).each(this.createMethod,this)}function s(e){var r;return t(e).map(function(e,s){return r={name:s,path:e,method:"GET"},t.isArray(e)&&t.extend(r,{path:e[0],method:e[1]}),r})}function n(e,r){var s=[],n=e.replace(/\{([^{}]*)\}/g,function(t,e){return e in r?(s.push(e),r[e]):e});return t(s).each(function(t){delete r[t]}),n}function o(t){this.context=t||this,this.success=[],this.error=[]}r.prototype.createMethod=function(t){var r,s;this[t.name]=function(n,c){return r=new o(this),c=this.createOptions(r,t,n,c),s=i[t.method.toUpperCase()],e.sync(s,this,c),r}},r.prototype.createOptions=function(e,r,s,o){var i=this,c=t.result(this.options,"url")+n(r.path,s);return o||(o={}),t.extend({url:c,data:s,success:function(t){o.success&&o.success.call(i,t),e.resolve(t)},error:function(t,r,s){o.error&&o.error.apply(i,[s,t]),e.reject(s,t)}},o)};var i={POST:"create",PUT:"update",DELETE:"delete",GET:"read"};t.extend(r.prototype,e.Events),e.Service=r,o.prototype={constructor:o,then:function(t,e){return t&&(this.resolved?t.apply(this.context,this.resolved):this.success.push(t)),e&&(this.rejected?e.apply(this.context,this.rejected):this.error.push(e)),this},resolve:function(){var t;for(this.resolved=arguments,this.error=[];t=this.success.shift();)t.apply(this.context,this.resolved)},reject:function(){var t;for(this.rejected=arguments,this.success=[];t=this.error.shift();)t.apply(this.context,this.rejected)}}});